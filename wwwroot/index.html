<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <base href="/" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Primary meta -->
  <title>BioMaint CMMS – Modern Maintenance Management</title>
  <meta name="description" content="BioMaint CMMS helps hospitals and enterprises manage assets, work orders, PM schedules, inventory, and compliance with ease." />
  <meta name="keywords" content="CMMS, maintenance software, hospital asset management, work orders, preventive maintenance, inventory tracking" />
  <meta name="author" content="BioMaint" />

  <!-- Open Graph -->
  <meta property="og:title" content="BioMaint CMMS – Modern Maintenance Management" />
  <meta property="og:description" content="Manage assets, work orders, PM schedules, and inventory like a modern SaaS." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://biomaint.com/" />
  <meta property="og:image" content="/images/og-banner.png" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="BioMaint CMMS – Modern Maintenance Management" />
  <meta name="twitter:description" content="Manage assets, work orders, PM schedules, and inventory like a modern SaaS." />
  <meta name="twitter:image" content="/images/og-banner.png" />

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />

  <!-- Favicon / Icons -->
  <link rel="icon" type="image/svg+xml" href="assets/logos/BioMaint.svg" />
  <link rel="alternate icon" type="image/png" sizes="32x32" href="assets/logos/favicon-32x32.png" />
  <link rel="alternate icon" type="image/png" sizes="16x16" href="assets/logos/favicon-16x16.png" />
  <link rel="mask-icon" href="assets/logos/BioMaint.svg" color="#10B981" />
  <link rel="apple-touch-icon" sizes="180x180" href="assets/logos/ios-180x180.png" />
  <link rel="shortcut icon" href="assets/logos/favicon.ico" />

  <!-- Theme color -->
  <meta id="theme-color" name="theme-color" content="#10B981" />
  <meta name="color-scheme" content="light dark" />

  <!-- Prevent theme flash -->
  <script>
    (function () {
      try {
        var BRAND = '#10B981';
        var saved = localStorage.getItem('biomaint-theme') || 'auto';
        var eff = (saved === 'light' || saved === 'dark')
          ? saved
          : (window.matchMedia && matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');

        var doc = document.documentElement;
        doc.setAttribute('data-bs-theme', eff);
        doc.style.colorScheme = eff;

        var meta = document.querySelector('meta[name="theme-color"]');
        if (meta) meta.setAttribute('content', eff === 'dark' ? '#0b0f13' : BRAND);
      } catch {}
    })();
  </script>

  <!-- CSS -->
  <link rel="stylesheet" href="css/bootstrap/bootstrap.min.css" />
  <link rel="stylesheet" href="css/theme.css" />

  <!-- Bootstrap Icons (CDN) -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

  <!-- Cloudflare Turnstile perf hints -->
  <link rel="dns-prefetch" href="https://challenges.cloudflare.com">
  <link rel="preconnect" href="https://challenges.cloudflare.com" crossorigin>
</head>
<body>
  <div id="app"></div>

  <div id="blazor-error-ui">
    An unhandled error has occurred.
    <a href="" class="reload">Reload</a>
    <a class="dismiss">×</a>
  </div>

  <!-- JS (order matters) -->
  <!-- Local Bootstrap first -->
  <script src="js/bootstrap/bootstrap.bundle.min.js" defer></script>
  <!-- Optional CDN fallback -->
  <script>
    window.addEventListener('DOMContentLoaded', function () {
      if (typeof window.bootstrap === 'undefined') {
        var s = document.createElement('script');
        s.src = 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js';
        document.head.appendChild(s);
      }
    });
  </script>

  <!-- Theme runtime -->
  <script src="js/theme.js" defer></script>

  <!-- Cloudflare Turnstile API (explicit render) -->
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js?render=explicit" async defer></script>

  <!-- Robust Turnstile login wrapper (external) -->
  <script src="js/turnstile-login.js" defer></script>

  <!-- Inline fallback helper (kept). Only defines if external didn't. -->
  <script>
    (function () {
      if (window.BioMaintLogin) return; // external loaded, keep it
      window.BioMaintLogin = (function () {
        let widgetId = null;
        let token = null;

        function render(siteKey, elementId) {
          const el = document.getElementById(elementId);
          if (!el) return;

          const doRender = function () {
            if (!window.turnstile) return; // API not ready yet
            if (widgetId !== null) {
              try { turnstile.reset(widgetId); } catch {}
              token = null;
            }
            widgetId = turnstile.render(el, {
              sitekey: siteKey,
              theme: 'auto',
              callback: function (t) { token = t; },
              'error-callback': function () { token = null; },
              'expired-callback': function () { token = null; }
            });
          };

          if (window.turnstile) {
            doRender();
          } else {
            const iv = setInterval(function () {
              if (window.turnstile) { clearInterval(iv); doRender(); }
            }, 50);
            setTimeout(() => clearInterval(iv), 5000);
          }
        }

        function getToken() { return token || null; }
        function reset() {
          if (widgetId !== null && window.turnstile) {
            try { turnstile.reset(widgetId); } catch {}
          }
          token = null;
        }

        // Provide same API surface as external where possible
        return { init: render, getToken, reset };
      })();
    })();
  </script>

  <!-- Blazor boot -->
  <script src="_framework/blazor.webassembly.js"></script>
</body>
</html>
